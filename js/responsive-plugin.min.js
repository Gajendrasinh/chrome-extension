function getIFrame(chk){
    if ($(chk).is(":checked")) {
        $('#'+$(chk).val()).show();
        setWidth();
    }else{ 
        $('#'+$(chk).val()).hide();
        setWidth();
    }
}

function getUrlVars(){
    var vars = [], hash;
    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for(var i = 0; i < hashes.length; i++)
    {
        hash = hashes[i].split('=');
        vars.push(hash[0]);
        vars[hash[0]] = hash[1];
    }
    return vars;
}

function loadIframes($frame, url) { 
    $('.frames-container iframe').not($frame).data('loaded', false);
    $('.frames-container iframe').not($frame).attr('src', url);
}

function setWidth(){
    $('.frames-container .inner-container').css('width', 0);
    $('.frames-container .inner-container').css('width', function() {
        var width = 0;
        $('.frames-container .frame').each(function() {                    
            if($(this).is(":visible")){
                width += $(this).outerWidth() + 20;                    
            }
        });
        return width;
    });
} 

$(document).ready(function () {
    $("input[type=checkbox]").change(function() {
        getIFrame(this)
    });

    function isError(){
        console.log("error")
    }
});

$(".hideSetting").click(function(){
    $('.control-section').hide();
    $(".showSetting").show();
});

$(".showSetting").click(function(){
    $(this).hide();
    $('.control-section, .hideSetting').show();
});    

$('input[type=radio]').change(function() {
    $frames = $('.frames-container');
    $inputs = $('input[type=radio]:checked').val();
    if ($inputs == '1') {
        $frames.addClass('widthOnly');
    } else {
        $frames.removeClass('widthOnly');
    }
});

function checkIFrameLoaded() {
    var results = [];
    $('.frames-container iframe').each(function() {
        if (!$(this).data('loaded')) {
            results.push(false)
        }
    });
    var result = (results.length > 0) ? false : true;
    return result;
};

function loadIframesFun(){

    var objIframe = [
        { id: 'f1', width : '240', height : '320'},
        { id: 'f2', width : '320', height : '480'},
        { id: 'f3', width : '480', height : '640'},
        { id: 'f4', width : '768', height : '1024'},
        { id: 'f5', width : '1024', height : '768'},
        { id: 'f6', width : '1366', height : '768'},
        { id: 'f7', width : '1440', height : '900'},
        { id: 'f8', width : '1600', height : '900'},
        { id: 'f9', width : '1920', height : '1080'},
    ];

    var iFrameList = '';
    var checkboxOption = '';

    $.each(objIframe, function (key, value) {
        checkboxOption +=  "<label class='checkbox-inline'><input type='checkbox' value='"+value.id+"' id='check_"+value.id+"' checked >"+value.width+" X "+value.height+"</label>";
        iFrameList += " <div id='"+value.id+"' class='frame'> <h3 class='title'>"+value.width+"<span id='width-only'> X " +value.height+ "</span></h3>  <iframe id='iframe_"+value.id+"'  name='iframe_"+value.id+"' sandbox='allow-scripts allow-same-origin allow-forms' seamless width='"+value.width+"' height='"+value.height+"'>  <p>Your browser does not support iframes.</p></iframe> </div>";	
    });

    $('.checkbox-list').append(checkboxOption);
    $('.inner-container').append(iFrameList);

    var defaultURL =  getUrlVars()["url"];

    loadIframes('', defaultURL);

    var qs = defaultURL;

    if (qs != '') {
        $('.control-section input[type=text]').val(qs);
        loadIframes('', qs);
    }
    setWidth();

    $('form').submit(function() {
        var URLChanged = $('.control-section input[type=text]').val();

        if(URLChanged == '' || URLChanged == undefined || URLChanged == null){
            $('#error-section').text("Please enter valid URL of your webpage and try again!.").show();
            $('.frames-container, #server-error').hide();
            return false;
        }else{
            $('#error-section').hide();
            $('.frames-container').show();
            loadIframes('', $('.control-section input[type=text]').val());
            return false;
        }
    });
    
    $('.frames-container iframe').load(function() {

        var $this = $(this);
        var url = '';
        var error = false;
        var iFrameID =  $(this).attr('id');

        var myFrame = $("iframe");

        var myDocument = $(myFrame.get(0).contentDocument);
        url =  myDocument.context
        console.log(url);
        // alert(url)
                    

        // try {
        //     url = $this.contents().get(0).location.href;
        //     $('#server-error').hide();
        // } catch (e) {

        //     if(e){
        //         var url = $('.control-section input[type=text]').val();
        //         $('#server-error').show();
        //         $('.frames-container').hide();
        //     }
        // }
        
        });
    
    var $cache = $('h3.title');
    var vTop = $cache.offset().top - parseFloat($cache.css('margin-top').replace(/auto/, 0));
    $(window).scroll(function (event) {
        var y = $(this).scrollTop();
        if (y >= vTop) {
        $cache.addClass('stuck');
        } else {
        $cache.removeClass('stuck');
        }
    });
};

loadIframesFun();
